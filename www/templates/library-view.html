<ion-view>
    <ion-nav-title></ion-nav-title>

    <ion-nav-buttons side="right">
        <button type="button" class="button icon button-clean ion-android-more-vertical ng-hide" ng-click="onAction($event, bookView)" ng-show="bookView.is_owner"></button>
    </ion-nav-buttons>



  <ion-content class="book-view" scroll="false">


    <div class="wait-message" ng-show="loading">
        <ion-spinner class="spinner-energized"></ion-spinner>
    </div>

    <div class="book-head" ng-hide="loading">
        <h2>{{bookView.title}}</h2>
        <h3>{{bookView.author}}</h3>
    </div>

    <ion-scroll direction="y" style="width: 100%; height: 100%">
    <div ng-hide="loading">
        
        
        

        <div class="card">
            <div class="item" href="#">
              <img ng-src="{{bookView.thumb}}" class="cover">
              <div class="info">
                  <p><span>ISBN</span>{{bookView.isbn}}</p>
                  <p ng-show="bookView.page_count>0"><span>Páginas</span>{{bookView.page_count}}</p>
                  <p ng-show="bookView.publisher"><span>Editora</span>{{bookView.publisher}}</p>
                  <p ng-show="bookView.published_date"><span>Publicação</span>{{bookView.published_date | date:'dd/MM/yyyy'}}</p>
                  
              </div>
            </div>
        </div>

        <div class="card" ng-show="bookView.loaned && bookView.loaned.id==user.id">
            <div class="item item-divider item-line" >
              Empréstimo

            </div>
            <div class="item item-avatar loan">
                <img ng-src="{{bookView.loaned.photo}}">
                    {{bookView.loaned.fullname}}
                    <p><strong>Data</strong> {{bookView.loaned.date | date:'dd/MM/yyyy'}}</p>
                    <p ng-show="bookView.loaned.expired>0"><strong>Tempo</strong> {{bookView.loaned.expired}} dias</p>

                    <p ng-show="bookView.loaned.status=='requested'" >
                        <strong>Status</strong> Aguardando 
                        ( <a ng-click="onChangeStatus('requested_canceled')" href="#" class="energized">Cancelar</a> )
                    </p>

                    <p ng-show="bookView.loaned.status=='wait_delivery' || bookView.loaned.status=='sent'" >
                        Seu amigo entregou o livro?
                         <a ng-click="onChangeStatus('delivered')" href="#" class="energized">Sim</a>
                    </p>

          </div>
        </div>


        <div class="card" ng-show="bookView.loaned && bookView.is_owner">
            <div class="item item-divider item-line" >
              Empréstimo
            </div>
            <div class="item item-avatar loan">
                <img ng-src="{{bookView.loaned.photo}}">
                    {{bookView.loaned.fullname}}
                    <p><strong>Data</strong> {{bookView.loaned.date | date:'dd/MM/yyyy'}}</p>
                    <p ng-show="bookView.loaned.expired>0"><strong>Tempo</strong> {{bookView.loaned.expired}} dias</p>
                    <p ng-show="bookView.loaned.expired<=0" >Atrasado</p>

                    <p ng-show="bookView.loaned.status=='wait_delivery'" >
                        <strong>Status</strong> Aguardando usuário confirmar
                        ( <a ng-click="onChangeStatus('wait_delivery_canceled')" href="#" class="energized">Cancelar</a> )
                    </p>

                    <p ng-show="bookView.loaned.status=='sent'" >
                        <strong>Status</strong> Aguardando usuário confirmar
                        ( <a ng-click="onChangeStatus('sent_canceled')" href="#" class="energized">Cancelar</a> )
                    </p>

          </div>

          <div class="item loan" ng-show="bookView.loaned.status=='requested'">
                <p>Emprestar?</p>
                <button class="button button-small" ng-click="onChangeStatus('requested_denied')">Não</button>
                <button class="button button-small" ng-click="onChangeStatus('wait_delivery')">Sim</button>
          </div>
        </div>

        <div class="card" ng-show="bookView.loaned && !bookView.is_owner && bookView.loaned.id!=user.id">
            <div class="item item-divider item-line" >
              Empréstimo
            </div>
            <div class="item loan">
                Este livro já está emprestado para outra pessoa.

          </div>
        </div>

        <div class="card" ng-hide="bookView.loaned || !bookView.is_owner">
            <div class="item item-line">
                <a class="button button-energized button-block request-loan"  ui-sref="app.loanAdd({id:bookView.id})">Emprestar este livro</a>
            </div>
        </div>

        <div class="card" ng-hide="bookView.loaned || bookView.is_owner">
            <div class="item item-line">
                <button class="button button-energized button-block request-loan"  ng-click="onRequestLoan(bookView)">
                    Solicitar emprestimo deste livro
                </button>
            </div>
        </div>



        <div class="card" style="margin-bottom: 130px;" ng-show="bookView.description">
            <div class="item item-divider item-line" >
              Sinopse
            </div>
            <div class="item item-text-wrap description" ng-bind-html="bookView.description">

            </div>
        </div>

      
    </div>
    </ion-scroll>
  </ion-content>

</ion-view>